
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>D√©mo √âvolution dynamique</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map { height: 100%; margin: 0; font-family: sans-serif; }
    #new-signal {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 14px;
      z-index: 1001;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      text-decoration: none;
      color: black;
    }
    #controls {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 14px;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }
    #controls > * {
      margin: 2px;
    }
    input[type="range"] {
      width: 160px;
      transition: opacity 0.3s ease;
    }
    input[type="range"].disabled {
      opacity: 0.3;
      pointer-events: none;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: bold;
    }
    @media (max-width: 600px) {
      #controls {
        flex-direction: column;
        padding: 8px;
      }
      input[type="range"] {
        width: 100%;
      }
    }
  </style>
</head>
<body>
<a href="index.html" id="new-signal">‚ûï Faire un nouveau signalement</a>
<div id="map"></div>
<div id="controls">
  <label for="preset">üìÖ P√©riode :</label>
  <select id="preset">
    <option value="today">Aujourd‚Äôhui</option>
    <option value="yesterday">Hier</option>
    <option value="last7">7 derniers jours</option>
    <option value="last30">30 derniers jours</option>
    <option value="custom">P√©riode personnalis√©e</option>
    <option value="single">Choisir une date</option>
  </select>
  <div class="checkbox-group">
    <label><input type="checkbox" id="modeTimeline" checked /> √âvolution <strong>dynamique</strong></label>
    <label><input type="checkbox" id="modeSynthese" /> Synth√®se p√©riode</label>
  </div>
  <label for="slider">‚è±Ô∏è</label>
  <input type="range" id="slider" min="0" max="5" step="1" value="0" />
  <span id="sliderLabel">00:00</span>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([44.214, 0.606], 14);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const getColor = i => ["#FADADD", "#F5B7B1", "#EC7063", "#E74C3C", "#CB4335", "#943126", "#78281F"][Math.min(6, Math.max(0, i - 1))];
  const generatePoints = n => Array.from({ length: n }, (_, i) => [{ lat: 44.21 + i * 0.001, lon: 0.606 + i * 0.001, intensite: 1 + (i % 7) }]);
  const dataset = {
    today: generatePoints(6),
    yesterday: generatePoints(6),
    last7: generatePoints(7),
    last30: generatePoints(10),
    custom: generatePoints(4),
    single: generatePoints(6)
  };

  const slider = document.getElementById("slider");
  const label = document.getElementById("sliderLabel");
  const preset = document.getElementById("preset");
  const modeTimeline = document.getElementById("modeTimeline");
  const modeSynthese = document.getElementById("modeSynthese");

  let currentLayer = null;
  let activeData = dataset["today"];
  let activeLabels = [];

  const updateMap = (points) => {
    if (currentLayer) map.removeLayer(currentLayer);
    currentLayer = L.layerGroup();
    points.forEach(pt => {
      L.circle([pt.lat, pt.lon], {
        color: getColor(pt.intensite),
        fillColor: getColor(pt.intensite),
        fillOpacity: 0.6,
        radius: 60
      }).addTo(currentLayer);
    });
    currentLayer.addTo(map);
  };

  const getLabels = (key, len) => {
    if (key === "today" || key === "yesterday" || key === "single") return Array.from({ length: len }, (_, i) => `00:${(i * 10).toString().padStart(2, '0')}`);
    if (key === "last7") return Array.from({ length: len }, (_, i) => `${i}h`);
    return Array.from({ length: len }, (_, i) => `Jour ${i + 1}`);
  };

  function syncMode(timelineChecked) {
    modeTimeline.checked = timelineChecked;
    modeSynthese.checked = !timelineChecked;
    slider.classList.toggle("disabled", !timelineChecked);
    slider.disabled = !timelineChecked;
    if (timelineChecked) {
      updateMap(activeData[slider.value]);
      label.innerText = activeLabels[slider.value];
    } else {
      updateMap(activeData.flat());
      label.innerText = "Vue globale";
    }
  }

  modeTimeline.onchange = () => syncMode(true);
  modeSynthese.onchange = () => syncMode(false);

  preset.onchange = () => {
    const key = preset.value;
    activeData = dataset[key];
    activeLabels = getLabels(key, activeData.length);
    slider.max = activeData.length - 1;
    slider.value = 0;
    syncMode(modeTimeline.checked);
  };

  slider.oninput = () => {
    if (modeTimeline.checked) {
      label.innerText = activeLabels[slider.value];
      updateMap(activeData[slider.value]);
    }
  };

  // Init
  activeLabels = getLabels("today", dataset.today.length);
  syncMode(true);
</script>
</body>
</html>
